<h2>Vulnerable Change Password</h2>
<form method="post">
  {% csrf_token %}
  <label>Username: <input name="username" required></label><br>
  <label>Old Password: <input type="password" name="old_password" required></label><br>
  <label>New Password: <input type="password" name="new_password" required></label><br>
  <label>Reset Token (if provided): <input name="token"></label><br>
  <button type="submit">Change</button>
</form>
<script>
  const tokenInput = document.querySelector('input[name="token"]');
  const oldPasswordInput = document.querySelector('input[name="old_password"]');

  function syncOldPasswordRequirement() {
    const hasToken = tokenInput.value.trim().length > 0;
    oldPasswordInput.required = !hasToken;
    oldPasswordInput.disabled = hasToken;
    if (hasToken) {
      oldPasswordInput.value = "";
    }
  }

  tokenInput.addEventListener("input", syncOldPasswordRequirement);
  syncOldPasswordRequirement();
</script>
<p>{{ message }}</p>
